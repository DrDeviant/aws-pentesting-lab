# AWS Pen-Testing Laboratory

PenTesting laboratory deployed as IaC with Terraform on AWS. 
It deploys a Kali Linux instance accessible via ssh &amp; wireguard VPN. 
Vulnerable instances in a private subnet.


NOTE: 
* Ids only defined for region "eu-west-1"
* For other regions, kali ami id must be specified and metasploitable3 id (after building it)


## Diagram

![Architecture Diagram](./diagram.png?raw=true)

## Components

- Kali 2020.4 instance (private key is saved into kali.pem)
  - Wireguard VPN service: client file client_vpn.wg
  - Accessible via ssh/scp
  - *Public* Subnet 10.0.0.5/24 
- Vulnerable machine "Metasploitable" (ami build is public)
  - *Private* subnet 10.0.1.5/24
- More vulnerable labs/machines/docker (to-be-done)


## How-To

* Requirements: 
  - Terraform CLI [install guide](https://learn.hashicorp.com/terraform/getting-started/install.html)
  - AWS CLI [install guide](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html)
  - $PATH configured for AWS CLI & Terraform
  - AWS account and configure credentials via aws cli: ```aws configure```
  - Kali Linux Subscription in AWS Marketplace (version 2020.04)
  - Metasploitable3 AMI image previously built (public AMI available for eu-west-1 region) [see](metasploitable3/)


# Deploy
```
terraform init
terraform plan
terraform apply -auto-approve   
```

# Usage

Either connect to Kali via ssh or wireguard:

* SSH: (Only command line) Use autogenerated private key (see terraform output)
* Wireguard: Connect your local kali instance via wireguard (see client_vpn.wg generated file)

# Destroy
```
terraform destroy -auto-approve
```


# References

- [rapid7 / metasploitable3](https://github.com/rapid7/metasploitable3) -  [license](https://github.com/rapid7/metasploitable3/blob/master/LICENSE)
- [Kali 2020.4 AWS Marketplace](https://aws.amazon.com/marketplace/pp/B08LL91KKB) 
- [terraform-aws-ec2-kali-linux](https://github.com/offensive-terraform/terraform-aws-ec2-kali-linux)
