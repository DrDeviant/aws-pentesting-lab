#!/bin/bash

yum install -y docker
service docker start

export CONTAINER_NAME=dvca-backent

#Use AWS IAM to pull the ECR container
$(aws ecr get-login --no-include-email --region ${AWS::Region})

docker pull ${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/dvca-fargate-backend
docker rm $CONTAINER_NAME || true
docker run --name $CONTAINER_NAME -p 80:80 -d --restart=always ${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/dvca-fargate-backend

docker rm $CONTAINER_NAME